(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d207327"],{a002:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("div",{staticClass:"title"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[e._v("监管记录")]),i("el-breadcrumb-item",{staticClass:"actived"},[e._v("整改记录")])],1)],1),i("div",{staticClass:"box"},[i("el-row",[e.listLoading?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}]},[e._v("装货...")]):e._e()]),i("el-dialog",{attrs:{visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",[i("i",{staticClass:"el-icon-warning"},[e._v(" 请选择图片 !!!")])]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")])],1)]),e.listLoading||e.isNanData?e._e():i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}]},[i("el-row",[i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"乡镇"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.data.townId,callback:function(t){e.$set(e.data,"townId",t)},expression:"data.townId"}},e._l(e.township,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"企业"}},[i("el-select",{model:{value:e.data.companyId,callback:function(t){e.$set(e.data,"companyId",t)},expression:"data.companyId"}},e._l(e.companyList,(function(e){return i("el-option",{key:e.companyId,attrs:{label:e.companyName,value:e.companyId}})})),1)],1)],1),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"选择日期"}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期"},model:{value:e.data.rectificationRecordTime,callback:function(t){e.$set(e.data,"rectificationRecordTime",t)},expression:"data.rectificationRecordTime"}})],1)],1),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"检查人"}},[i("el-input",{staticStyle:{width:"60%"},model:{value:e.data.inspector,callback:function(t){e.$set(e.data,"inspector",t)},expression:"data.inspector"}})],1)],1)],1),i("div",{staticClass:"bg-blue"},[e._v("检查内容与结果")]),i("el-row",[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"left-margin"},[i("table",[i("tbody",[i("tr",[i("td",{attrs:{rowspan:"2"}},[e._v("结论")]),i("td",[e._v("合格")]),i("td",[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:e.data.conclusion,callback:function(t){e.$set(e.data,"conclusion",t)},expression:"data.conclusion"}})],1)]),i("tr",[i("td",[e._v("不合格")]),i("td",[i("table",{staticClass:"no-border"},[i("tbody",[i("tr",[i("td",[e._v("责令修改")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.data.conclusion},model:{value:e.conclusionData.order,callback:function(t){e.$set(e.conclusionData,"order",t)},expression:"conclusionData.order"}})],1)]),i("tr",[i("td",[e._v("建议处罚")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.data.conclusion},model:{value:e.conclusionData.suggestion,callback:function(t){e.$set(e.conclusionData,"suggestion",t)},expression:"conclusionData.suggestion"}})],1)]),i("tr",[i("td",[e._v("其他处理")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.data.conclusion},model:{value:e.conclusionData.others,callback:function(t){e.$set(e.conclusionData,"others",t)},expression:"conclusionData.others"}})],1)])])])])])])])])]),i("el-col",{attrs:{span:11}},[i("table",{staticClass:"image-upload-table"},[i("tbody",[i("tr",[i("td",[e._v("现场图片")]),i("td",{attrs:{colspan:"3"}},[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_Live()}}},[e.images?i("img",{staticClass:"preview",attrs:{src:e.images}}):e._e(),!e.images&&e.data.scenePhotos?i("img",{staticClass:"preview",attrs:{src:e.downloadURL+e.data.scenePhotos}}):e._e()]),!e.file_live_1&&e.data.scenePhotos?i("el-link",{staticStyle:{display:"table"},on:{click:function(t){return e.downloadFile(e.data.scenePhotos)}}},[e._v("\n                    "+e._s(e.data.scenePhotos.replace("/uploads/",""))+"\n                  ")]):e._e(),e.file_live_1?i("p",[e._v(e._s(e.fileName))]):e._e(),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_1",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file",accept:"image/*",name:"images"},on:{change:function(t){return e.handleFileUpload_Live()}}})])],1)]),i("tr",[i("td",[e._v("签名")]),i("td",[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_Sign()}}},[e.signs?i("img",{staticClass:"preview",attrs:{src:e.signs}}):e._e(),!e.signs&&e.data.supervisionSign?i("img",{staticClass:"preview",attrs:{src:e.downloadURL+e.data.supervisionSign}}):e._e()]),!e.file_live_2&&e.data.supervisionSign?i("el-link",{staticStyle:{display:"table"},on:{click:function(t){return e.downloadFile(e.data.supervisionSign)}}},[e._v("\n                    "+e._s(e.data.supervisionSign.replace("/uploads/",""))+"\n                  ")]):e._e(),e.file_live_2?i("p",[e._v(e._s(e.signName))]):e._e(),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_2",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file1",accept:"image/*",name:"signs"},on:{change:function(t){return e.handleFileUpload_Sign()}}})])],1),i("td",[e._v("确认人签名")]),i("td",[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_CofirmSign()}}},[e.confirmSigns?i("img",{staticClass:"preview",attrs:{src:e.confirmSigns}}):e._e(),!e.confirmSigns&&e.data.confirmorSign?i("img",{staticClass:"preview",attrs:{src:e.downloadURL+e.data.confirmorSign}}):e._e()]),!e.file_live_3&&e.data.confirmorSign?i("el-link",{staticStyle:{display:"table"},on:{click:function(t){return e.downloadFile(e.data.confirmorSign)}}},[e._v("\n                    "+e._s(e.data.confirmorSign.replace("/uploads/",""))+"\n                  ")]):e._e(),e.file_live_3?i("p",[e._v(e._s(e.confirmSignName))]):e._e(),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_3",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file2",accept:"image/*",name:"confirmSigns"},on:{change:function(t){return e.handleFileUpload_ConfirmSign()}}})])],1)])])])])],1),i("el-form-item",{staticClass:"left-margin"},[i("el-button",{attrs:{size:"small",type:"success",plain:""},on:{click:e.onSubmit}},[e._v("保存")]),i("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1),!e.listLoading&&e.isNanData?i("el-form",{ref:"ruleForm",attrs:{model:e.ruleFormValue,rules:e.rules}},[i("el-row",[i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"乡镇",prop:"townId"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleFormValue.townId,callback:function(t){e.$set(e.ruleFormValue,"townId",t)},expression:"ruleFormValue.townId"}},e._l(e.township,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),i("el-col",{attrs:{span:5}},[i("el-form-item",{attrs:{label:"企业",prop:"companyId"}},[i("el-select",{model:{value:e.ruleFormValue.companyId,callback:function(t){e.$set(e.ruleFormValue,"companyId",t)},expression:"ruleFormValue.companyId"}},e._l(e.companyList,(function(e){return i("el-option",{key:e.companyId,attrs:{label:e.companyName,value:e.companyId}})})),1)],1)],1),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"选择日期",prop:"createTime"}},[i("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期"},model:{value:e.ruleFormValue.createTime,callback:function(t){e.$set(e.ruleFormValue,"createTime",t)},expression:"ruleFormValue.createTime"}})],1)],1),i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"检查人",prop:"inspector"}},[i("el-input",{staticStyle:{width:"60%"},model:{value:e.ruleFormValue.inspector,callback:function(t){e.$set(e.ruleFormValue,"inspector",t)},expression:"ruleFormValue.inspector"}})],1)],1)],1),i("div",{staticClass:"bg-blue"},[e._v("检查内容与结果")]),i("el-row",[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"left-margin"},[i("table",[i("tbody",[i("tr",[i("td",{attrs:{rowspan:"2"}},[e._v("结论")]),i("td",[e._v("合格")]),i("td",[i("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:e.ruleFormValue.conclusion,callback:function(t){e.$set(e.ruleFormValue,"conclusion",t)},expression:"ruleFormValue.conclusion"}})],1)]),i("tr",[i("td",[e._v("不合格")]),i("td",[i("table",{staticClass:"no-border"},[i("tbody",[i("tr",[i("td",[e._v("责令修改")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.ruleFormValue.conclusion},model:{value:e.ruleFormValue.order,callback:function(t){e.$set(e.ruleFormValue,"order",t)},expression:"ruleFormValue.order"}})],1)]),i("tr",[i("td",[e._v("建议处罚")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.ruleFormValue.conclusion},model:{value:e.ruleFormValue.suggestion,callback:function(t){e.$set(e.ruleFormValue,"suggestion",t)},expression:"ruleFormValue.suggestion"}})],1)]),i("tr",[i("td",[e._v("其他处理")]),i("td",[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1==e.ruleFormValue.conclusion},model:{value:e.ruleFormValue.others,callback:function(t){e.$set(e.ruleFormValue,"others",t)},expression:"ruleFormValue.others"}})],1)])])])])])])])])]),i("el-col",{attrs:{span:11}},[i("table",{staticClass:"image-upload-table"},[i("tbody",[i("tr",[i("td",[e._v("现场图片")]),i("td",{attrs:{colspan:"3"}},[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_Live()}}},[i("img",{staticClass:"preview",attrs:{src:e.images}})]),i("p",[e._v(e._s(e.fileName))]),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_1",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file",accept:"image/*",name:"images"},on:{change:function(t){return e.handleFileUpload_Live()}}})])])]),i("tr",[i("td",[e._v("签名")]),i("td",[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_Sign()}}},[i("img",{staticClass:"preview",attrs:{src:e.signs}})]),i("p",[e._v(e._s(e.signName))]),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_2",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file1",accept:"image/*",name:"signs"},on:{change:function(t){return e.handleFileUpload_Sign()}}})])]),i("td",[e._v("确认人签名")]),i("td",[i("div",{staticClass:"img-container",on:{click:function(t){return e.chooseFile_CofirmSign()}}},[i("img",{staticClass:"preview",attrs:{src:e.confirmSigns}})]),i("p",[e._v(e._s(e.confirmSignName))]),i("div",{staticClass:"image-box"},[i("input",{ref:"file_live_3",staticClass:"image-upload",staticStyle:{display:"none"},attrs:{type:"file",id:"file2",accept:"image/*",name:"confirmSigns"},on:{change:function(t){return e.handleFileUpload_ConfirmSign()}}})])])])])])])],1),i("el-form-item",{staticClass:"left-margin"},[i("el-button",{attrs:{size:"small",type:"success",plain:""},on:{click:function(t){return e.onSubmit("ruleForm")}}},[e._v("保存")]),i("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1):e._e()],1)])},n=[],l=(i("a481"),i("7f7f"),i("55a1")),s=i("d1a0"),o=i("0010"),r=i("bc3a"),c=i.n(r),d={data:function(){return{images:"",fileName:"",signs:"",signName:"",confirmSigns:"",confirmSignName:"",superId:-1,listLoading:!1,data:[],pageLoading:!1,imageUrl_Live:"",imageUrl_Sign:"",imageUrl_ConfirmSign:"",file_live_1:null,file_live_2:null,file_live_3:null,township:[{id:-1,name:"全部"}],companyList:[{id:-1,name:"全部"}],conclusionData:null,isNanData:null,downloadURL:"",ruleFormValue:{townId:"-1",companyId:"-1",createTime:"",inspector:"",conclusion:"0",order:"",suggestion:"",others:""},dialogVisible:!1,rules:{townId:[{required:!0,message:"请选择",trigger:"change"}],companyId:[{required:!0,message:"请选择",trigger:"change"}],createTime:[{required:!0,message:"请选择",trigger:"change"}],inspector:[{required:!0,message:"请插入",trigger:"change"}]}}},created:function(){this.superId=this.$route.params.id,this.downloadURL=s["b"].DOWNLOAD_URL(),this.getTown(),this.getCompanyProduct(),this.getData()},methods:{getTown:function(){var e=this;Object(l["a"])().get("/api/town/all").then((function(t){e.township=e.township.concat(t)})).catch((function(e){console.log(e)}))},getCompanyProduct:function(){var e=this;Object(l["a"])().get("/api/company_production/name").then((function(t){e.companyList=e.companyList.concat(t)})).catch((function(e){console.log(e)}))},getData:function(){var e=this;this.listLoading=!0,Object(l["a"])().get("/api/rectification_record/all?supervisionRecordId="+this.superId,{sortBy:"id"}).then((function(t){var i=t.data;e.data=i[0],e.isNanData=!e.data,e.isNanData||(e.conclusionData=JSON.parse(e.data.conclusionFalseInfo)),setTimeout((function(){e.listLoading=!1}),500)})).catch((function(e){console.log(e)}))},onSubmit:function(e){var t,i=this,a=new FormData;a.append("scenePhotoFile",this.file_live_1),a.append("signFile",this.file_live_2),a.append("confirmor",this.file_live_3),a.append("supervisionRecordId",this.superId),this.isNanData?(t=1==this.ruleFormValue.conclusion?{order:" ",suggestion:" ",others:" "}:{order:this.ruleFormValue.order?this.ruleFormValue.order:" ",suggestion:this.ruleFormValue.suggestion?this.ruleFormValue.suggestion:" ",others:this.ruleFormValue.others?this.ruleFormValue.others:" "},t=JSON.stringify(t),a.append("id",0),a.append("towId",this.ruleFormValue.townId),a.append("conclusion",this.ruleFormValue.conclusion),a.append("inspector",this.ruleFormValue.inspector),a.append("companyId",this.ruleFormValue.companyId),a.append("updateTime",this.ruleFormValue.createTime),a.append("updateUserId",Object(o["a"])().user().id),a.append("createUserId",Object(o["a"])().user().id),a.append("createTime",this.ruleFormValue.createTime),a.append("rectificationRecordTime",this.ruleFormValue.createTime),a.append("conclusionFalseInfo",t),this.$refs[e].validate((function(e){e&&(i.listLoading=!0,Object(l["a"])().post("/api/rectification_record/create",a).then((function(e){setTimeout((function(){i.listLoading=!1}),1e3),i.$router.push({path:"/regulatoryRecord"})})).catch((function(e){console.log(e)})))}))):(t={order:this.conclusionData.order?this.conclusionData.order:" ",suggestion:this.conclusionData.suggestion?this.conclusionData.suggestion:" ",others:this.conclusionData.others?this.conclusionData.others:" "},t=JSON.stringify(t),a.append("townId",this.data.townId),a.append("id",this.data.id),a.append("inspector",this.data.inspector),a.append("companyId",this.data.companyId),this.data.rectificationRecordTime=new Date(this.data.rectificationRecordTime).toDateString("YYYY-MM-DD"),a.append("createTime",this.data.rectificationRecordTime),a.append("rectificationRecordTime",this.data.rectificationRecordTime),a.append("updateUserId",Object(o["a"])().user().id),a.append("conclusionFalseInfo",t),this.pageLoading=!0,Object(l["a"])().put("/api/rectification_record/update/"+this.data.id,a).then((function(e){setTimeout((function(){i.pageLoading=!1}),500),i.$router.push({path:"/regulatoryRecord"})})).catch((function(e){})))},chooseFile_Live:function(){document.getElementById("file").click()},chooseFile_Sign:function(){document.getElementById("file1").click()},chooseFile_CofirmSign:function(){document.getElementById("file2").click()},handleFileUpload_Live:function(){this.file_live_1=this.$refs.file_live_1.files[0],this.images="";var e=new FileReader,t=this;e.onload=function(e){t.images=e.target.result},this.file_live_1?(e.readAsDataURL(this.file_live_1),this.fileName=this.file_live_1.name):this.fileName=""},handleFileUpload_Sign:function(){this.file_live_2=this.$refs.file_live_2.files[0],this.signs="";var e=new FileReader,t=this;e.onload=function(e){t.signs=e.target.result},this.file_live_2?(e.readAsDataURL(this.file_live_2),this.signName=this.file_live_2.name):this.signName=""},handleFileUpload_ConfirmSign:function(){this.file_live_3=this.$refs.file_live_3.files[0],this.confirmSigns="";var e=new FileReader,t=this;e.onload=function(e){t.confirmSigns=e.target.result},this.file_live_3?(e.readAsDataURL(this.file_live_3),this.confirmSignName=this.file_live_3.name):this.confirmSignName=""},downloadFile:function(e){c()({url:s["b"].DOWNLOAD_URL()+e,method:"GET",responseType:"blob"}).then((function(t){var i=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=i,a.setAttribute("download",e.replace("/uploads/","")),document.body.appendChild(a),a.click(),a.remove()}))}}},u=d,m=i("2877"),p=Object(m["a"])(u,a,n,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d207327.8921de81.js.map