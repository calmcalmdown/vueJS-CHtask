{"version":3,"sources":["webpack:///./src/components/jobDefinition/editJobDefinition/editJobDefinition.vue?d5c4","webpack:///src/components/jobDefinition/editJobDefinition/editJobDefinition.vue","webpack:///./src/components/jobDefinition/editJobDefinition/editJobDefinition.vue?4267","webpack:///./src/components/jobDefinition/editJobDefinition/editJobDefinition.vue?0006","webpack:///./src/components/jobDefinition/editJobDefinition/editJobDefinition.vue?58ff"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","directives","name","rawName","value","expression","ref","editForm","rules","model","callback","$$v","$set","_l","item","key","id","on","$event","chooseFile","src","staticStyle","handleFileUpload","file","_e","downloadFile","_s","jobFile","replace","onSubmit","$router","go","staticRenderFns","data","created","isIE","mounted","jobName","$route","query","jobType","params","getData","methods","document","getElementById","click","is_ie","ua","indexOf","makeFormData","component"],"mappings":"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","file":"js/chunk-7975686c.a7b440d6.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"title\"},[_c('el-breadcrumb',{attrs:{\"separator\":\"/\"}},[_c('el-breadcrumb-item',[_vm._v(\"作业定义\")]),_c('el-breadcrumb-item',{staticClass:\"actived\"},[_vm._v(\"修改作业\")])],1)],1),_c('div',{staticClass:\"box\"},[_c('el-form',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.dataloading),expression:\"dataloading\"}],ref:\"editForm\",attrs:{\"model\":_vm.editForm,\"rules\":_vm.rules,\"label-width\":\"120px\"}},[_c('el-form-item',{staticClass:\"job-name-width\",attrs:{\"prop\":\"jobName\",\"label\":\"作业名称\"}},[_c('el-input',{attrs:{\"auto-complete\":\"off\"},model:{value:(_vm.editForm.jobName),callback:function ($$v) {_vm.$set(_vm.editForm, \"jobName\", $$v)},expression:\"editForm.jobName\"}})],1),_c('el-form-item',{attrs:{\"label\":\"作业类型\",\"prop\":\"jobType\"}},[_c('el-select',{attrs:{\"placeholder\":\"请选择\"},model:{value:(_vm.editForm.jobType),callback:function ($$v) {_vm.$set(_vm.editForm, \"jobType\", $$v)},expression:\"editForm.jobType\"}},_vm._l((_vm.jobTypes),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.name,\"value\":item.id}})}),1)],1),_c('el-form-item',{attrs:{\"label\":\"现场图片\"}},[_c('div',{staticClass:\"image-container\",on:{\"click\":function($event){return _vm.chooseFile()}}},_vm._l((_vm.images),function(src){return _c('img',{key:src,staticClass:\"preview\",attrs:{\"src\":src}})}),0),_c('div',{staticClass:\"image-box\"},[_c('input',{ref:\"file\",staticClass:\"image-upload\",staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\",\"id\":\"file\",\"accept\":\"image/*\",\"name\":\"images\"},on:{\"change\":function($event){return _vm.handleFileUpload()}}})]),(!_vm.file)?_c('div',{staticClass:\"item-value\"},[_c('el-link',{on:{\"click\":function($event){return _vm.downloadFile()}}},[_vm._v(\"\\n                  \"+_vm._s(_vm.editForm.jobFile.replace(\"/uploads/\", \"\"))+\"\\n              \")])],1):_vm._e(),(_vm.file)?_c('div',{staticClass:\"item-value\"},[_vm._v(\"\\n              \"+_vm._s(_vm.file.name)+\"\\n          \")]):_vm._e()]),_c('el-form-item',{staticClass:\"left-margin\"},[_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"success\",\"plain\":\"\"},on:{\"click\":function($event){return _vm.onSubmit('editForm')}}},[_vm._v(\"\\n              保存\\n          \")]),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"danger\",\"plain\":\"\"},on:{\"click\":function($event){return _vm.$router.go(-1)}}},[_vm._v(\"\\n              取消\\n          \")])],1)],1)],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"container\">\r\n    <div class=\"title\">\r\n      <el-breadcrumb separator=\"/\">\r\n        <el-breadcrumb-item>作业定义</el-breadcrumb-item>\r\n        <el-breadcrumb-item class=\"actived\">修改作业</el-breadcrumb-item>\r\n      </el-breadcrumb>\r\n    </div>\r\n\r\n    <div class=\"box\">\r\n      <el-form \r\n        ref=\"editForm\" \r\n        :model=\"editForm\" \r\n        :rules=\"rules\" \r\n        label-width=\"120px\"\r\n        v-loading=\"dataloading\"\r\n    >\r\n        <el-form-item prop=\"jobName\" label=\"作业名称\" class=\"job-name-width\">\r\n            <el-input \r\n                v-model=\"editForm.jobName\" \r\n                auto-complete=\"off\"\r\n            >\r\n            </el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"作业类型\" prop=\"jobType\">\r\n            <el-select v-model=\"editForm.jobType\" placeholder=\"请选择\">\r\n                <el-option\r\n                    v-for=\"item in jobTypes\"\r\n                    :key=\"item.id\"\r\n                    :label=\"item.name\"\r\n                    :value=\"item.id\"\r\n                >\r\n                </el-option>\r\n            </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"现场图片\">\r\n            <div \r\n                @click=\"chooseFile()\"\r\n                class=\"image-container\"\r\n            >\r\n                <img \r\n                    v-for=\"src in images\" \r\n                    :src=\"src\" \r\n                    :key=\"src\" \r\n                    class=\"preview\"\r\n                >\r\n            </div>\r\n            <div class=\"image-box\">\r\n                <input\r\n                    type=\"file\"\r\n                    id=\"file\"\r\n                    ref=\"file\"\r\n                    class=\"image-upload\"\r\n                    accept=\"image/*\"\r\n                    v-on:change=\"handleFileUpload()\"\r\n                    name=\"images\"\r\n                    style=\"display:none\"\r\n                />\r\n            </div>\r\n            <div class=\"item-value\" v-if=\"!file\">\r\n                <el-link @click=\"downloadFile()\">\r\n                    {{ editForm.jobFile.replace(\"/uploads/\", \"\") }}\r\n                </el-link>\r\n            </div>\r\n            <div class=\"item-value\" v-if=\"file\">\r\n                {{ file.name }}\r\n            </div>\r\n        </el-form-item>\r\n        <el-form-item class=\"left-margin\">\r\n            <el-button size=\"small\" type=\"success\" plain @click=\"onSubmit('editForm')\">\r\n                保存\r\n            </el-button>\r\n            <el-button size=\"small\" type=\"danger\" plain v-on:click=\"$router.go(-1)\">\r\n                取消\r\n            </el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Request from \"../../../services/api/request.js\";\r\nimport { Urls } from \"../../../services/constants\";\r\nimport axios from \"axios\";\r\nexport default {\r\n  data() {\r\n    return {\r\n        editForm: {\r\n            jobName: \"\",\r\n            jobType: \"\",\r\n            jobFile: \"\"\r\n        },\r\n        jobTypes: [\r\n            { id: 0, name: \"收获前\" },\r\n            { id: 1, name: \"收获\" },\r\n            { id: 2, name: \"收获后\" }\r\n        ],\r\n        rules: {\r\n            jobName: [\r\n            {\r\n                required: true,\r\n                message: \"请插入\",\r\n                trigger: \"change\"\r\n            }],\r\n            jobType: [\r\n            {\r\n                required: true,\r\n                message: \"请选择\",\r\n                trigger: \"change\"\r\n            }],\r\n        },\r\n        images:[],\r\n        file: null,\r\n        dataloading: true,\r\n        id: 0,\r\n        is_ie:null\r\n    };\r\n  },\r\n  created(){\r\n    this.isIE();\r\n  },\r\n  mounted() {\r\n    this.editForm.jobName = this.$route.query.jobName;\r\n    this.editForm.jobType = this.$route.query.jobType;\r\n    this.id = this.$route.params.id;\r\n    this.getData(this.$route.params.id);\r\n  },\r\n  methods: {\r\n    getData(id) {\r\n        this.dataloading = true;\r\n        Request()\r\n            .get(\"/api/job_definition/get/\" + id)\r\n            .then(response => {\r\n                this.editForm = response;\r\n                this.images = [];\r\n                this.images.push(Urls.DOWNLOAD_URL() + this.editForm.jobFile)\r\n                setTimeout(() => {\r\n                    this.dataloading = false;\r\n                }, 0.01 * 1000);\r\n            })\r\n            .catch(error => {\r\n                console.log(error);\r\n            });\r\n    },\r\n    downloadFile() {\r\n        axios({\r\n            url: Urls.DOWNLOAD_URL() + this.editForm.jobFile,\r\n            method: \"GET\",\r\n            responseType: \"blob\" // important\r\n        }).then(response => {\r\n            if(!this.is_ie){\r\n                const url = window.URL.createObjectURL(new Blob([response.data]));\r\n                const link = document.createElement(\"a\");\r\n                link.href = url;\r\n                \r\n                link.setAttribute(\r\n                    \"download\",\r\n                    this.editForm.jobFile.replace(\"/uploads/\", \"\")\r\n                ); //or any other extension\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                link.remove();\r\n            }else{\r\n                const newBlob = new Blob([response.data], {type: 'application/octet-stream'});\r\n                if (window.navigator && window.navigator.msSaveOrOpenBlob) {\r\n                    window.navigator.msSaveOrOpenBlob(newBlob, this.editForm.jobFile.replace(\"/uploads/\", \"\"));\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    },\r\n    onSubmit(formName) {\r\n        this.$refs[formName].validate(valid => {\r\n            if (valid) {\r\n                this.dataloading = true;\r\n                var formData = new FormData();\r\n                formData = this.makeFormData();\r\n                Request()\r\n                    .put(\"/api/job_definition/update/\" + this.id, formData)\r\n                    .then(response => {\r\n                        this.$router.push({ path: \"/jobDefinition\" });\r\n                        setTimeout(() => {\r\n                            this.dataloading = false;\r\n                        }, 0.01 * 1000);\r\n                    })\r\n                    .catch(error => {});\r\n            }\r\n        });\r\n    },\r\n    chooseFile() {\r\n      document.getElementById('file').click()\r\n    },\r\n    isIE() {\r\n      let ua = navigator.userAgent;\r\n      /* MSIE used to detect old browsers and Trident used to newer ones*/\r\n      this.is_ie = ua.indexOf(\"MSIE \") > -1 || ua.indexOf(\"Trident/\") > -1;\r\n    },\r\n    handleFileUpload() {\r\n        this.file = this.$refs.file.files[0];\r\n        this.images = [];\r\n        let reader = new FileReader();\r\n        let that = this;\r\n        reader.onload = function (e) {\r\n            that.images.push(e.target.result);\r\n\r\n        }\r\n        reader.readAsDataURL(this.file); \r\n    },\r\n    makeFormData() {\r\n        var mainFormData = new FormData();\r\n        mainFormData.append(\"jobName\", this.editForm.jobName);\r\n        mainFormData.append(\"jobType\", this.editForm.jobType);\r\n        mainFormData.append(\"file\", this.file);\r\n        mainFormData.append(\"id\", this.id);\r\n        return mainFormData;\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.image-container {\r\n    border: 1px solid;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./editJobDefinition.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./editJobDefinition.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./editJobDefinition.vue?vue&type=template&id=11c0786a&scoped=true&\"\nimport script from \"./editJobDefinition.vue?vue&type=script&lang=js&\"\nexport * from \"./editJobDefinition.vue?vue&type=script&lang=js&\"\nimport style0 from \"./editJobDefinition.vue?vue&type=style&index=0&id=11c0786a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"11c0786a\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./editJobDefinition.vue?vue&type=style&index=0&id=11c0786a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./editJobDefinition.vue?vue&type=style&index=0&id=11c0786a&scoped=true&lang=css&\""],"sourceRoot":""}